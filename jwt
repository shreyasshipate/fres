
 private final List<MediaRecord> mediaStore = new ArrayList<>();
    private int sequenceId = 1;
 public ResponseEntity<?> upload(
            @RequestParam("file") MultipartFile file,
            @AuthenticationPrincipal CustomUserDetails user
    ) throws Exception {

        Integer userId = user.getId();

        // ensure upload directory exists
        String uploadDir = "src/main/resources/uploads/";
        new File(uploadDir).mkdirs();

        // save file
        String fullPath = uploadDir + file.getOriginalFilename();
        Files.copy(file.getInputStream(), Path.of(fullPath), StandardCopyOption.REPLACE_EXISTING);

        // create record
        MediaRecord record = new MediaRecord(
                sequenceId++,
                file.getOriginalFilename(),
                file.getContentType(),
                fullPath,
                userId
        );

        mediaStore.add(record);

        // build JSON for response
        JSONObject json = new JSONObject();
        json.put("id", record.id());
        json.put("filename", record.filename());
        json.put("contentType", record.contentType());
        json.put("path", record.path());
        json.put("userId", record.userId());

        return ResponseEntity.ok(json.toString());
    }
